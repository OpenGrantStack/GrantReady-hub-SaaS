```shell
#!/bin/bash
# cf-dns-menu.sh - Interactive Cloudflare DNS manager with autocomplete
 
CF_ENV="$HOME/.cf-dns.env"
CF_DOMAIN="opengrantstack.io"
CACHE="$HOME/.cf-zone.cache"
 
# Load API token
if [[ ! -f "$CF_ENV" ]]; then
    echo "Create $CF_ENV with: CF_API_TOKEN='your_token_here'"
    exit 1
fi
source "$CF_ENV"
if [[ -z "$CF_API_TOKEN" ]]; then
    echo "CF_API_TOKEN not set in $CF_ENV"
    exit 1
fi
 
# Requirements
for cmd in curl jq; do
    command -v $cmd >/dev/null || { echo "$cmd required! Install: pkg install $cmd"; exit 1; }
done
 
# Get Zone ID
if [[ -f "$CACHE" ]]; then
    ZONE_ID=$(<"$CACHE")
else
    ZONE_ID=$(curl -s -X GET "https://api.cloudflare.com/client/v4/zones?name=$CF_DOMAIN" \
        -H "Authorization: Bearer $CF_API_TOKEN" \
        -H "Content-Type: application/json" | jq -r '.result[0].id')
    if [[ -z "$ZONE_ID" || "$ZONE_ID" == "null" ]]; then
        echo "Failed to fetch Zone ID for $CF_DOMAIN"
        exit 1
    fi
    echo "$ZONE_ID" > "$CACHE"
fi
 
# ===== FUNCTIONS =====
get_records() {
    curl -s -X GET "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records" \
        -H "Authorization: Bearer $CF_API_TOKEN" \
        -H "Content-Type: application/json" | jq -r '.result[] | "\(.id) \(.type) \(.name) -> \(.content)"'
}
 
select_record() {
    mapfile -t RECORDS < <(get_records)
    if [[ ${#RECORDS[@]} -eq 0 ]]; then
        echo "No records found."
        return 1
    fi
    echo "Select a record:"
    select REC in "${RECORDS[@]}"; do
        if [[ -n "$REC" ]]; then
            RECORD_ID=$(echo "$REC" | awk '{print $1}')
            break
        else
            echo "Invalid selection."
        fi
    done
}
 
list_records() {
    get_records
}
 
add_record() {
    read -p "Subdomain (without domain, e.g., www): " SUB
    read -p "Type (A, AAAA, CNAME): " TYPE
    read -p "Content (IP or target): " CONTENT
    read -p "TTL (seconds, default 120): " TTL
    TTL=${TTL:-120}
    read -p "Proxied? (true/false, default false): " PROXIED
    PROXIED=${PROXIED:-false}

    RESPONSE=$(curl -s -X POST "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records" \
        -H "Authorization: Bearer $CF_API_TOKEN" \
        -H "Content-Type: application/json" \
        --data "{\"type\":\"$TYPE\",\"name\":\"$SUB.$CF_DOMAIN\",\"content\":\"$CONTENT\",\"ttl\":$TTL,\"proxied\":$PROXIED}")
    echo "$RESPONSE" | jq
}
 
update_record() {
    select_record || return
    read -p "New content (IP or target): " CONTENT
    read -p "New TTL (seconds, default 120): " TTL
    TTL=${TTL:-120}
    read -p "Proxied? (true/false, default false): " PROXIED
    PROXIED=${PROXIED:-false}

    RESPONSE=$(curl -s -X PUT "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records/$RECORD_ID" \
        -H "Authorization: Bearer $CF_API_TOKEN" \
        -H "Content-Type: application/json" \
        --data "{\"content\":\"$CONTENT\",\"ttl\":$TTL,\"proxied\":$PROXIED}")
    echo "$RESPONSE" | jq
}
 
delete_record() {
    select_record || return
    RESPONSE=$(curl -s -X DELETE "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records/$RECORD_ID" \
        -H "Authorization: Bearer $CF_API_TOKEN" \
        -H "Content-Type: application/json")
    echo "$RESPONSE" | jq
}
 
# ===== MAIN MENU =====
while true; do
    echo
    echo "Cloudflare DNS Manager for $CF_DOMAIN"
    echo "1) List DNS records"
    echo "2) Add a record"
    echo "3) Update a record"
    echo "4) Delete a record"
    echo "5) Exit"
    echo -n "Choose an option: "
    read OPT

    case "$OPT" in
        1) list_records ;;
        2) add_record ;;
        3) update_record ;;
        4) delete_record ;;
        5) exit 0 ;;
        *) echo "Invalid option" ;;
    esac
done
```
